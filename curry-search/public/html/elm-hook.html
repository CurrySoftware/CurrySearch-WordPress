<div id="curry-search-autocomplete"></div>
<script>
  function insertAfter(referenceNode, newNode) {
    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
  }

  var flags = {
    url: "<?php echo $url ?>",
    public_api_key: "<?php echo $public_api_key ?>",
    session_hash: "<?php echo $session_hash ?>"
  }

  var search_field = document.getElementById("<?php echo $input_id?>");
  var suggest_list = document.getElementById("curry-search-autocomplete");

  var search_rect = search_field.getBoundingClientRect();
  var suggest_rect = suggest_list.getBoundingClientRect();

  var height_diff = search_rect.bottom - suggest_rect.top;
  var neg_height_diff = -height_diff;
  suggest_list.style = "margin-top: " + height_diff+"px; padding-bottom: " + neg_height_diff+"px;";

  var app = Elm.CurrySearchAutoComplete.embed(suggest_list, flags);

  search_field.addEventListener("keydown", function(e) {
      if (e.keyCode == '38' ) {
          //Up Arrow
          app.ports.search_box_arrow.send(-1);
          e.preventDefault();
      } else if (e.keyCode == '40') {
          //Down arrow
          app.ports.search_box_arrow.send(1);
          e.preventDefault();
      };
  });

  search_field.addEventListener("input", function(e) {
      app.ports.search_box_input.send(e.target.value);
  });

  app.ports.suggest_choice.subscribe(function(term) {
      search_field.value = term;
      search_field.focus();
  });
</script>
